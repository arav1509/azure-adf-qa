{
	"name": "DistrictWiseCases_SCD_Type2",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DistrictWiseCases_Land",
						"type": "DatasetReference"
					},
					"name": "DistrictWiseCasesLand"
				},
				{
					"dataset": {
						"referenceName": "DistrictWiseCases_trg",
						"type": "DatasetReference"
					},
					"name": "TrgGetMaxSurrogateKey"
				},
				{
					"dataset": {
						"referenceName": "DistrictWiseCases_trg",
						"type": "DatasetReference"
					},
					"name": "Trg1"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DistrictWiseCases_trg",
						"type": "DatasetReference"
					},
					"name": "DistrictWiseCasesInsert"
				},
				{
					"dataset": {
						"referenceName": "DistrictWiseCases_trg",
						"type": "DatasetReference"
					},
					"name": "DistrictWiseCasesUpdate"
				}
			],
			"transformations": [
				{
					"name": "ConfirmedCases"
				},
				{
					"name": "SelectColumns1"
				},
				{
					"name": "MaxSurrogateID"
				},
				{
					"name": "SurrogateKey1"
				},
				{
					"name": "MAXJoin"
				},
				{
					"name": "SCDColmns"
				},
				{
					"name": "SelectColumn2"
				},
				{
					"name": "SelectTrgColumns"
				},
				{
					"name": "TrgHashKey"
				},
				{
					"name": "Lookup1"
				},
				{
					"name": "GetDuplicateValues"
				},
				{
					"name": "FilterActiveColumns"
				},
				{
					"name": "AlterRow1"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "SelectRequriedColumns"
				}
			],
			"script": "source(output(\n\t\tState as string,\n\t\tState_Code as string,\n\t\tDistrict_Key as string,\n\t\tDistrict as string,\n\t\tConfirmed as string,\n\t\tDistrictWiseConfirmedCasesRank as string,\n\t\tTotal_state_ConfirmedCases as string,\n\t\tActive as string,\n\t\tDistrictWiseActiveCasesRank as string,\n\t\tTotal_state_ActiveCases as string,\n\t\tRecovered as string,\n\t\tDistrictWiseRecoveredCasesRank as string,\n\t\tTotal_state_RecoveredCases as string,\n\t\tDeathCases as string,\n\t\tDistrictWiseDeceasedCasesRank as string,\n\t\tTotal_state_DeathCases as string,\n\t\tLoad_date as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> DistrictWiseCasesLand\nsource(output(\n\t\tDistrictWise_key as integer,\n\t\tState as string,\n\t\tState_Code as string,\n\t\tDistrict_Key as string,\n\t\tDistrict as string,\n\t\tConfirmed as integer,\n\t\tDistrictWiseConfirmedCasesRank as integer,\n\t\tTotal_state_ConfirmedCases as integer,\n\t\tActive as integer,\n\t\tDistrictWiseActiveCasesRank as integer,\n\t\tTotal_state_ActiveCases as integer,\n\t\tRecovered as integer,\n\t\tDistrictWiseRecoveredCasesRank as integer,\n\t\tTotal_state_RecoveredCases as integer,\n\t\tDeathCases as integer,\n\t\tDistrictWiseDeceasedCasesRank as integer,\n\t\tTotal_state_DeathCases as integer,\n\t\tLoad_date as date,\n\t\tStart_date as date,\n\t\tEnd_date as date,\n\t\tIs_Active as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> TrgGetMaxSurrogateKey\nsource(output(\n\t\tDistrictWise_key as integer,\n\t\tState as string,\n\t\tState_Code as string,\n\t\tDistrict_Key as string,\n\t\tDistrict as string,\n\t\tConfirmed as integer,\n\t\tDistrictWiseConfirmedCasesRank as integer,\n\t\tTotal_state_ConfirmedCases as integer,\n\t\tActive as integer,\n\t\tDistrictWiseActiveCasesRank as integer,\n\t\tTotal_state_ActiveCases as integer,\n\t\tRecovered as integer,\n\t\tDistrictWiseRecoveredCasesRank as integer,\n\t\tTotal_state_RecoveredCases as integer,\n\t\tDeathCases as integer,\n\t\tDistrictWiseDeceasedCasesRank as integer,\n\t\tTotal_state_DeathCases as integer,\n\t\tLoad_date as date,\n\t\tStart_date as date,\n\t\tEnd_date as date,\n\t\tIs_Active as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> Trg1\nDistrictWiseCasesLand derive(Confirmed_Tran = toInteger(Confirmed),\n\t\tDistrictWiseConfirmedCasesRank_Tran = toInteger(DistrictWiseConfirmedCasesRank),\n\t\tTotal_state_ConfirmedCases_Tran = toInteger(Total_state_ConfirmedCases),\n\t\tActive_Tran = toInteger(Active),\n\t\tDistrictWiseActiveCasesRank_Tran = toInteger(DistrictWiseActiveCasesRank),\n\t\tTotal_state_ActiveCases_Tran = toInteger(Total_state_ActiveCases),\n\t\tRecovered_Tran = toInteger(Recovered),\n\t\tDistrictWiseRecoveredCasesRank_Tran = toInteger(DistrictWiseRecoveredCasesRank),\n\t\tTotal_state_RecoveredCases_Tran = toInteger(Total_state_RecoveredCases),\n\t\tDeathCases_Tran = toInteger(DeathCases),\n\t\tDistrictWiseDeceasedCasesRank_Tran = toInteger(DistrictWiseDeceasedCasesRank),\n\t\tTotal_state_DeathCases_Tran = toInteger(Total_state_DeathCases),\n\t\tCurrent_date = toDate(Load_date,'dd-MMM-yyyy')) ~> ConfirmedCases\nConfirmedCases select(mapColumn(\n\t\tState,\n\t\tState_Code,\n\t\tDistrict_Key,\n\t\tDistrict,\n\t\tTotal_state_ConfirmedCases = Total_state_ConfirmedCases_Tran,\n\t\tConfirmed = Confirmed_Tran,\n\t\tDistrictWiseConfirmedCasesRank = DistrictWiseConfirmedCasesRank_Tran,\n\t\tActive = Active_Tran,\n\t\tDistrictWiseActiveCasesRank = DistrictWiseActiveCasesRank_Tran,\n\t\tTotal_state_ActiveCases = Total_state_ActiveCases_Tran,\n\t\tRecovered = Recovered_Tran,\n\t\tDistrictWiseRecoveredCasesRank = DistrictWiseRecoveredCasesRank_Tran,\n\t\tTotal_state_RecoveredCases = Total_state_RecoveredCases_Tran,\n\t\tDeathCases = DeathCases_Tran,\n\t\tDistrictWiseDeceasedCasesRank = DistrictWiseDeceasedCasesRank_Tran,\n\t\tTotal_state_DeathCases = Total_state_DeathCases_Tran,\n\t\tLoad_date = Current_date\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectColumns1\nTrgGetMaxSurrogateKey aggregate(Max_ID = coalesce(max(DistrictWise_key),0)) ~> MaxSurrogateID\nMAXJoin keyGenerate(output(SurrogateKey1 as long),\n\tstartAt: 1L) ~> SurrogateKey1\nSelectColumns1, MaxSurrogateID join(1==1,\n\tjoinType:'cross',\n\tbroadcast: 'auto')~> MAXJoin\nSurrogateKey1 derive(DistrictWise_key = Max_ID+SurrogateKey1,\n\t\tIs_Active = 1,\n\t\tStart_date = currentUTC(),\n\t\tEnd_date = toDate('31-DEC-3000','dd-MMM-yyyy'),\n\t\tHash_Key = md5(State,State_Code,District_Key,District,(Confirmed),(DistrictWiseConfirmedCasesRank),(Total_state_ConfirmedCases),(Active),(DistrictWiseActiveCasesRank),(Total_state_ActiveCases),(Recovered),(DistrictWiseRecoveredCasesRank),(Total_state_RecoveredCases),(DeathCases),(DistrictWiseDeceasedCasesRank),(Total_state_DeathCases),(Load_date))) ~> SCDColmns\nSCDColmns select(mapColumn(\n\t\tState,\n\t\tState_Code,\n\t\tDistrict_Key,\n\t\tDistrict,\n\t\tTotal_state_ConfirmedCases,\n\t\tConfirmed,\n\t\tDistrictWiseConfirmedCasesRank,\n\t\tActive,\n\t\tDistrictWiseActiveCasesRank,\n\t\tTotal_state_ActiveCases,\n\t\tRecovered,\n\t\tDistrictWiseRecoveredCasesRank,\n\t\tTotal_state_RecoveredCases,\n\t\tDeathCases,\n\t\tDistrictWiseDeceasedCasesRank,\n\t\tTotal_state_DeathCases,\n\t\tLoad_date,\n\t\tHash_Key,\n\t\tDistrictWise_key,\n\t\tIs_Active,\n\t\tStart_date,\n\t\tEnd_date\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectColumn2\nFilterActiveColumns select(mapColumn(\n\t\ttrg_State = State,\n\t\ttrg_State_Code = State_Code,\n\t\ttrg_District_Key = District_Key,\n\t\ttrg_District = District,\n\t\ttrg_Total_state_ConfirmedCases = Total_state_ConfirmedCases,\n\t\ttrg_Confirmed = Confirmed,\n\t\ttrg_DistrictWiseConfirmedCasesRank = DistrictWiseConfirmedCasesRank,\n\t\ttrg_Active = Active,\n\t\ttrg_DistrictWiseActiveCasesRank = DistrictWiseActiveCasesRank,\n\t\ttrg_Total_state_ActiveCases = Total_state_ActiveCases,\n\t\ttrg_Recovered = Recovered,\n\t\ttrg_DistrictWiseRecoveredCasesRank = DistrictWiseRecoveredCasesRank,\n\t\ttrg_Total_state_RecoveredCases = Total_state_RecoveredCases,\n\t\ttrg_DeathCases = DeathCases,\n\t\ttrg_DistrictWiseDeceasedCasesRank = DistrictWiseDeceasedCasesRank,\n\t\ttrg_Total_state_DeathCases = Total_state_DeathCases,\n\t\ttrg_Load_date = Load_date,\n\t\ttrg_Start_date = Start_date,\n\t\ttrg_End_date = End_date,\n\t\ttrg_Is_Active = Is_Active,\n\t\tDistrictWise_key_PK = DistrictWise_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectTrgColumns\nSelectTrgColumns derive(TRG_Hash_Key = md5(trg_State,trg_State_Code,trg_District_Key,trg_District,(trg_Confirmed),(trg_DistrictWiseConfirmedCasesRank),(trg_Total_state_ConfirmedCases),(trg_Active),(trg_DistrictWiseActiveCasesRank),(trg_Total_state_ActiveCases),(trg_Recovered),(trg_DistrictWiseRecoveredCasesRank),(trg_Total_state_RecoveredCases),(trg_DeathCases),(trg_DistrictWiseDeceasedCasesRank),(trg_Total_state_DeathCases),(trg_Load_date))) ~> TrgHashKey\nSelectColumn2, TrgHashKey lookup(Hash_Key == TRG_Hash_Key,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> Lookup1\nLookup1 filter(!isNull(TRG_Hash_Key)) ~> GetDuplicateValues\nTrg1 filter(Is_Active=='1') ~> FilterActiveColumns\nDerivedColumn1 alterRow(updateIf(1==1)) ~> AlterRow1\nGetDuplicateValues derive(trg_Is_Active_update = 0,\n\t\ttrg_End_date_Update = currentDate()) ~> DerivedColumn1\nAlterRow1 select(mapColumn(\n\t\ttrg_State,\n\t\ttrg_State_Code,\n\t\ttrg_District_Key,\n\t\ttrg_District,\n\t\ttrg_Total_state_ConfirmedCases,\n\t\ttrg_Confirmed,\n\t\ttrg_DistrictWiseConfirmedCasesRank,\n\t\ttrg_Active,\n\t\ttrg_DistrictWiseActiveCasesRank,\n\t\ttrg_Total_state_ActiveCases,\n\t\ttrg_Recovered,\n\t\ttrg_DistrictWiseRecoveredCasesRank,\n\t\ttrg_Total_state_RecoveredCases,\n\t\ttrg_DeathCases,\n\t\ttrg_DistrictWiseDeceasedCasesRank,\n\t\ttrg_Total_state_DeathCases,\n\t\ttrg_Load_date,\n\t\ttrg_Start_date,\n\t\ttrg_End_date_Update,\n\t\ttrg_Is_Active_Update = trg_Is_Active_update,\n\t\tTRG_Hash_Key,\n\t\tDistrictWise_key_PK\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectRequriedColumns\nSelectColumn2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tDistrictWise_key as integer,\n\t\tState as string,\n\t\tState_Code as string,\n\t\tDistrict_Key as string,\n\t\tDistrict as string,\n\t\tConfirmed as integer,\n\t\tDistrictWiseConfirmedCasesRank as integer,\n\t\tTotal_state_ConfirmedCases as integer,\n\t\tActive as integer,\n\t\tDistrictWiseActiveCasesRank as integer,\n\t\tTotal_state_ActiveCases as integer,\n\t\tRecovered as integer,\n\t\tDistrictWiseRecoveredCasesRank as integer,\n\t\tTotal_state_RecoveredCases as integer,\n\t\tDeathCases as integer,\n\t\tDistrictWiseDeceasedCasesRank as integer,\n\t\tTotal_state_DeathCases as integer,\n\t\tLoad_date as date,\n\t\tStart_date as date,\n\t\tEnd_date as date,\n\t\tIs_Active as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 2,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tDistrictWise_key,\n\t\tState,\n\t\tState_Code,\n\t\tDistrict_Key,\n\t\tDistrict,\n\t\tConfirmed,\n\t\tDistrictWiseConfirmedCasesRank,\n\t\tTotal_state_ConfirmedCases,\n\t\tActive,\n\t\tDistrictWiseActiveCasesRank,\n\t\tTotal_state_ActiveCases,\n\t\tRecovered,\n\t\tDistrictWiseRecoveredCasesRank,\n\t\tTotal_state_RecoveredCases,\n\t\tDeathCases,\n\t\tDistrictWiseDeceasedCasesRank,\n\t\tTotal_state_DeathCases,\n\t\tLoad_date,\n\t\tStart_date,\n\t\tEnd_date,\n\t\tIs_Active\n\t)) ~> DistrictWiseCasesInsert\nSelectRequriedColumns sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tDistrictWise_key as integer,\n\t\tState as string,\n\t\tState_Code as string,\n\t\tDistrict_Key as string,\n\t\tDistrict as string,\n\t\tConfirmed as integer,\n\t\tDistrictWiseConfirmedCasesRank as integer,\n\t\tTotal_state_ConfirmedCases as integer,\n\t\tActive as integer,\n\t\tDistrictWiseActiveCasesRank as integer,\n\t\tTotal_state_ActiveCases as integer,\n\t\tRecovered as integer,\n\t\tDistrictWiseRecoveredCasesRank as integer,\n\t\tTotal_state_RecoveredCases as integer,\n\t\tDeathCases as integer,\n\t\tDistrictWiseDeceasedCasesRank as integer,\n\t\tTotal_state_DeathCases as integer,\n\t\tLoad_date as date,\n\t\tStart_date as date,\n\t\tEnd_date as date,\n\t\tIs_Active as string\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['DistrictWise_key'],\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tsaveOrder: 1,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tState = trg_State,\n\t\tState_Code = trg_State_Code,\n\t\tDistrict_Key = trg_District_Key,\n\t\tDistrict = trg_District,\n\t\tConfirmed = trg_Confirmed,\n\t\tDistrictWiseConfirmedCasesRank = trg_DistrictWiseConfirmedCasesRank,\n\t\tTotal_state_ConfirmedCases = trg_Total_state_ConfirmedCases,\n\t\tActive = trg_Active,\n\t\tDistrictWiseActiveCasesRank = trg_DistrictWiseActiveCasesRank,\n\t\tTotal_state_ActiveCases = trg_Total_state_ActiveCases,\n\t\tRecovered = trg_Recovered,\n\t\tDistrictWiseRecoveredCasesRank = trg_DistrictWiseRecoveredCasesRank,\n\t\tTotal_state_RecoveredCases = trg_Total_state_ConfirmedCases,\n\t\tDeathCases = trg_DeathCases,\n\t\tDistrictWiseDeceasedCasesRank = trg_DistrictWiseDeceasedCasesRank,\n\t\tTotal_state_DeathCases = trg_Total_state_DeathCases,\n\t\tStart_date = trg_State,\n\t\tEnd_date = trg_End_date_Update,\n\t\tIs_Active = trg_Is_Active_Update,\n\t\tDistrictWise_key = DistrictWise_key_PK\n\t)) ~> DistrictWiseCasesUpdate"
		}
	}
}